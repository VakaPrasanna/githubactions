name: CI Pipeline
'on':
  push:
    branches:
    - master
    - main
    - develop
  pull_request:
    branches:
    - master
    - main
    - develop
env:
  GRADLE_OPTS: -Dorg.gradle.daemon=false
permissions:
  contents: read
  actions: read
  security-events: write
  deployments: write
  checks: write
jobs:
  checkout:
    runs-on: ubuntu-latest
    timeout-minutes: 60
    steps:
    - uses: actions/checkout@v4
    - name: Run Checkout
      uses: ./.github/actions/checkout
  build:
    runs-on: ubuntu-latest
    needs: checkout
    timeout-minutes: 60
    steps:
    - uses: actions/checkout@v4
    - name: Run Build
      uses: ./.github/actions/build
  test:
    runs-on: ubuntu-latest
    needs: build
    timeout-minutes: 60
    steps:
    - uses: actions/checkout@v4
    - name: Run Test
      uses: ./.github/actions/test
    continue-on-error: true
  package:
    runs-on: ubuntu-latest
    needs: test
    timeout-minutes: 60
    steps:
    - uses: actions/checkout@v4
    - name: Run Package
      uses: ./.github/actions/package
  pipeline-post:
    name: Pipeline Post Actions
    runs-on: ubuntu-latest
    needs:
    - checkout
    - build
    - test
    - package
    if: always()
    timeout-minutes: 30
    steps:
    - uses: actions/checkout@v4
    - name: Publish test results (always)
      if: always()
      uses: dorny/test-reporter@v1
      with:
        name: Pipeline Test Results (always)
        path: build/test-results/test/*.xml
        reporter: java-junit
      continue-on-error: false
    - name: Publish HTML (always) - MANUAL CONVERSION REQUIRED
      if: always()
      run: "\n# MANUAL CONVERSION REQUIRED: PublishHTML Plugin\n# Original Jenkins feature: publishHTML([\n                        allowMissing: false,\n                        alwaysLinkToLastBuild: true,\n                        keepAll: true,\n                        reportDir: 'build/reports/tests/test',\n                        reportFiles: 'index.html',\n                        reportName: 'Test Report'\n                    ])\n# Action needed: Review Jenkins documentation and implement equivalent logic\n# TODO: Implement this functionality manually\n"
      shell: bash
